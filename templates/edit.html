{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">Member Information Form</h2>
                </div>
                <div class="card-body">
                    <form method="POST" id="memberForm" onsubmit="return confirmSubmit('memberForm');">
                        {{ form.csrf_token }}
                        
                        <!-- Personal Information -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="FirstName" class="form-label">First Name:</label>
                                {{ form.FirstName(class="form-control" + (" is-invalid" if form.FirstName.errors else ""), placeholder="Enter your first name") }}
                                {% if form.FirstName.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.FirstName.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.FirstName.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="MiddleName" class="form-label">Middle Name:</label>
                                {{ form.MiddleName(class="form-control" + (" is-invalid" if form.MiddleName.errors else ""), placeholder="Enter your middle name (optional)") }}
                                {% if form.MiddleName.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.MiddleName.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.MiddleName.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="LastName" class="form-label">Last Name:</label>
                                {{ form.LastName(class="form-control" + (" is-invalid" if form.LastName.errors else ""), placeholder="Enter your last name") }}
                                {% if form.LastName.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.LastName.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.LastName.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="Email" class="form-label">Email:</label>
                                {{ form.Email(class="form-control" + (" is-invalid" if form.Email.errors else ""), placeholder="Enter your email address") }}
                                {% if form.Email.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.Email.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.Email.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="MobileNo" class="form-label">Mobile Number (start with 260):</label>
                                {{ form.MobileNo(class="form-control" + (" is-invalid" if form.MobileNo.errors else ""), placeholder="e.g., 260977123456") }}
                                {% if form.MobileNo.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.MobileNo.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.MobileNo.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Location Information -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="Nationality" class="form-label">Country:</label>
                                {{ form.Nationality(class="form-select" + (" is-invalid" if form.Nationality.errors else "")) }}
                                {% if form.Nationality.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.Nationality.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.Nationality.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="CountryCode" class="form-label">Country Code:</label>
                                {{ form.CountryCode(class="form-control" + (" is-invalid" if form.CountryCode.errors else ""), readonly=true) }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="City" class="form-label">City:</label>
                                {{ form.City(class="form-select" + (" is-invalid" if form.City.errors else "")) }}
                                {% if form.City.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.City.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.City.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Address" class="form-label">Address:</label>
                            {{ form.Address(class="form-control" + (" is-invalid" if form.Address.errors else ""), placeholder="Enter your full address") }}
                            {% if form.Address.errors %}
                                <div class="invalid-feedback">
                                    {{ form.Address.errors[0] }}
                                </div>
                                <script>
                                    showAlert('Error', '{{ form.Address.errors[0] }}', 'error');
                                </script>
                            {% endif %}
                        </div>

                        <!-- Other Information -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="Gender" class="form-label">Gender:</label>
                                {{ form.Gender(class="form-select" + (" is-invalid" if form.Gender.errors else "")) }}
                                {% if form.Gender.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.Gender.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.Gender.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="DateofBirth" class="form-label">Date of Birth (DD/MM/YYYY):</label>
                                {{ form.DateofBirth(class="form-control" + (" is-invalid" if form.DateofBirth.errors else ""), placeholder="e.g., 25/12/1990") }}
                                {% if form.DateofBirth.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.DateofBirth.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.DateofBirth.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <!-- ID Information -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="IDNumber" class="form-label">ID Number:</label>
                                {{ form.IDNumber(class="form-control", readonly=true) }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="IDType" class="form-label">ID Type:</label>
                                {{ form.IDType(class="form-select" + (" is-invalid" if form.IDType.errors else "")) }}
                                {% if form.IDType.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.IDType.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.IDType.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Membership Information -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="MembershipCategory" class="form-label">Membership Category:</label>
                                {{ form.MembershipCategory(class="form-select" + (" is-invalid" if form.MembershipCategory.errors else "")) }}
                                {% if form.MembershipCategory.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.MembershipCategory.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.MembershipCategory.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="MonthlyDeduction" class="form-label">Monthly Deduction:</label>
                                {{ form.MonthlyDeduction(class="form-control" + (" is-invalid" if form.MonthlyDeduction.errors else ""), placeholder="Enter amount") }}
                                {% if form.MonthlyDeduction.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.MonthlyDeduction.errors[0] }}
                                    </div>
                                    <script>
                                        showAlert('Error', '{{ form.MonthlyDeduction.errors[0] }}', 'error');
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nationalitySelect = document.getElementById('Nationality');
    const countryCodeInput = document.getElementById('CountryCode');
    const citySelect = document.getElementById('City');

    // Function to update cities dropdown
    function updateCities(country) {
        if (!country) return;
        
        fetch(`/get_cities/${country}`)
            .then(response => response.json())
            .then(cities => {
                citySelect.innerHTML = '<option value="">Select City</option>';
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            });
    }

    // Function to update country code
    function updateCountryCode(country) {
        if (!country) return;
        
        fetch(`/get_country_code/${country}`)
            .then(response => response.json())
            .then(code => {
                countryCodeInput.value = code;
            });
    }

    // Event listener for country selection
    nationalitySelect.addEventListener('change', function() {
        const selectedCountry = this.value;
        updateCities(selectedCountry);
        updateCountryCode(selectedCountry);
    });

    // Initialize values if country is already selected
    if (nationalitySelect.value) {
        updateCities(nationalitySelect.value);
        updateCountryCode(nationalitySelect.value);
    }
});
</script>
{% endblock %}
